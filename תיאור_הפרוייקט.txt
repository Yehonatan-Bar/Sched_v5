## מסמך אפיון מוצר

אפליקציית ניהול משימות/פרויקטים אישית (Single User) עם צירי זמן היררכיים, RTL מלא, ו־UI דינמי.

---

# עקרונות כלליים

* שפה: עברית בלבד
* כיווניות: RTL בכל המסכים והרכיבים
* פלטפורמות: דסקטופ + מובייל (חובה)
* מצב תצוגה: בהיר/כהה
* אופי עיצוב: נקי אבל “חי/זורם/דינמי”
* שימוש: כמה פעמים ביום לתמונת מצב מה עשיתי ומה נשאר
* היקף נתונים: 3–10 פרויקטים במקביל (עם אפשרות להעמקה בתוך פרויקט)

---

# מושגים וישויות

* פרויקט: יחידת העל שמופיעה בדף הראשי כקומפוננטה נגררת
* משימת פרויקט (Milestone): אבן דרך מרכזית בפרויקט, מופיעה על ציר הזמן הראשי של הפרויקט
* תת־משימה: משימה שמשרתת משימה אחרת; לכל משימה יכולים להיות תתי־משימות
* קינון: בלתי מוגבל בעומק
* סטטוס משימה:

  * לא התחיל
  * בתהליך
  * תקוע
  * הושלם
  * מחכה ל: `<שם אדם>`
* עדיפות/תגיות: קיימות + צבעים
* זמן:

  * פרויקט כולל טווח זמן ידני (התחלה/סיום)
  * משימה יכולה להיות עם טווח (start/end) או ללא טווח (נקודת זמן)

---

# מסכים (Screens)

* דף ראשי: רשימת פרויקטים (קומפוננטות)
* דף פרויקט: רשימת תתי־משימות של הפרויקט כולו (ללא ציר זמן)
* (מודאל) תיאור מפורט לפרויקט
* (מודאל) מחברת טיוטה לפרויקט
* (מודאל) תיאור מפורט למשימה/תת־משימה (אייקון לכל משימה)

---

# מסך 1: דף ראשי — רשימת פרויקטים

## מבנה

* רשימת קומפוננטות אחת מתחת לשנייה
* גלילה כדי לראות את כל הפרויקטים
* אפשרות לגרירה למעלה/למטה לשינוי סדר
* הסדר ידני בלבד (אין מיון אוטומטי)

## אפקט “משתקף” ו”מתקטן”

* ככל שפרויקט נמוך יותר ברשימה (לפי אינדקס), כך:

  * חלק “משתקף” נהיה שקוף יותר
  * חלק “מתקטן” נהיה קטן יותר
* גבול תחתון: “עד שכמעט לא רואים”
* Hover בדסקטופ:

  * ריחוף מעל קומפוננטה מחזיר לגודל מלא ומבטל שקיפות (רק בזמן ריחוף)
* טאץ’ במובייל:

  * נגיעה קצרה מתנהגת כמו hover (הגדלה + ביטול שקיפות זמני)

## נעילה (“Sticky focus”)

* קליק על קומפוננטה במצב מלא:

  * הופך גודל מלא וחוסר שקיפות ליציבים עבור הפרויקט הספציפי
  * חוזר לברירת מחדל רק כש:

    * מרעננים את הדף, או
    * אחרי שעה מהקליק האחרון (מה שמגיע קודם)
* אם גוררים פרויקט נעול: הוא נשאר נעול
* הנעילה תקפה רק כל עוד הטאב פתוח (לא נשמרת בסגירת דפדפן)

## כפתור הוספה

* כפתור “+” צף בתחתית המסך תמיד
* יוצר פרויקט חדש עם ערכי ברירת מחדל לא חשובים (מינימליים)

## נגישות מקלדת

* שינוי סדר פרויקטים עם חיצי מקלדת (כאשר פרויקט “בפוקוס”)

---

# קומפוננטת פרויקט (במסך הראשי)

## רכיבים

* מרכז: עיגול עם:

  * שם הפרויקט (עריכה במקום)
  * תיאור קצר (עריכה במקום)
* אייקונים:

  * כניסה לדף פרויקט (URL נפרד)
  * פתיחת מודאל “תיאור מפורט של הפרויקט”
  * פתיחת מודאל “מחברת טיוטה” (טקסט חופשי לפרויקט)
* ציר זמן בצורת חץ מימין לשמאל:

  * לפני העיגול = עבר (מימין)
  * אחרי העיגול = עתיד (משמאל)
* טווח הציר (start/end) ניתן:

  * להזנה ידנית (תאריך התחלה/סיום)
  * לגרירה עם העכבר לשני הכיוונים
* ברירת מחדל לטווח בעת יצירה: רנדומלי, ולאחר מכן המשתמש מגדיר ידנית

---

# ציר זמן בתוך פרויקט (דרגה 1)

## עקרונות תצוגה

* מעל הציר: תאריכים בפורמט DD/MM/YY
* מתחת לציר: שמות משימות הפרויקט (milestones) + הברים שלהן
* ייצוג משימה: Bar לאורך הציר
* שם משימה: מופיע מתחת (לא על הבר, לא tooltip כברירת מחדל)

## גרירה/שינוי זמן

* משימה ניתנת:

  * לגרירה להזזת כל הטווח (start+end יחד)
  * לשינוי משך באמצעות גרירת קצוות (resize)
  * לעריכה ידנית בתיבה (start/end)
* Snap תמיד פעיל (ננעל לשנתות בהתאם לרמת הזום)

## זום וגלילה

* כאשר:

  * הקומפוננטה ננעלה (קליק), וגם
  * העכבר מרחף מעל ציר הזמן
    אז גלילה = זום
    אחרת גלילה = גלילת הדף
* Shift+Scroll: זום על ציר הזמן הקרוב ביותר לעכבר
* הזום מתרכז סביב מרכז הציר (לא סביב העכבר)
* רמות זום: חודשים (הכי רחב) → שבועות → ימים → שעות → דקות (הכי קטן)
* אין זום של שנים

## סינון תצוגה לפי זום + “רמז”

* הכללים הקיימים נשמרים, אבל:

  * בזומים רחבים אפשר להציג “רמז” (למשל סימון קטן) גם אם משימה לא אמורה להופיע במלואה
* משימה ללא טווח זמן:

  * מוצגת כנקודה/סמן יחיד על הציר (תמיד בנקודת זמן ייעודית)

## חפיפות משימות

* כאשר יש חפיפות:

  * המשימות “נפתחות” לשורות אחת מתחת לשנייה
  * לכל משימה צבע מובחן (גם לשם וגם לבר)
  * קו מחבר בין שם המשימה לבין הבר שלה על הציר

---

# דרגה 2: תתי־משימות בתוך משימה

* מתחת לציר הראשי, מוצגים שמות תתי־המשימות (דינאמי)
* לחיצה על תת־משימה:

  * שאר התתי־משימות הופכות לחצי שקופות ונעשות “ברקע בלבד” (לא ניתנות לבחירה)
  * נפתח מתחתיה ציר זמן קטן (קומפוננטה זהה בהיגיון)
  * הציר הקטן מייצג את תת־המשימה עצמה
* סגירה/חזרה:

  * קליק בחוץ או Esc

---

# דרגה 3: אנשים שקשורים למשימה

* מעל דרגה 2 מוצגים שמות אנשים כרפרנס טקסטואלי בלבד
* אין משתמשים אמיתיים, אין הרשאות, אין עומסים/זמינות/התראות
* סטטוס “מחכה ל” משתמש בשם אדם טקסטואלי

---

# הערות

* מתחת לדרגה 2 יש אזור הערות
* הערות הן טקסט חופשי אחד (לא רשימה, לא קבצים, לא @אזכורים)

---

# עריכה במקום (Inline Editing)

* שמירת עריכה: קליק החוצה
* Undo/היסטוריית שינויים: נדרש
* ולידציות:

  * שם ריק: “לא מופיע כלום” (כלומר מותר ריק, מציג ריק)
  * end לפני start: אסור (חייב למנוע ולתת שגיאה UI)
* שמירה לשרת:

  * אין autosave לכל שינוי
  * יש כפתור “שמור” גלובלי ששומר את כל השינויים לקובץ JSON

---

# דף פרויקט (מסך נפרד)

* נפתח דרך URL חדש מאייקון כניסה
* מציג רשימה של תתי־המשימות של הפרויקט כולו
* אין חיפוש/סינון/מיון
* אין ציר זמן בדף זה (רשימה בלבד)

---

# שמירה, גרסאות, וקונפליקטים

* אחסון: קובץ JSON בשרת (FastAPI)
* קונפליקט עריכה משני טאבים:

  * “האחרון מנצח”
* גיבוי/גרסאות:

  * נדרש מנגנון snapshot עם timestamps
* סכימה קשיחה:

  * כן (Pydantic) + מוכנות ל־migration עתידי

---

# הצעת סכימת JSON

> עקרונות: מזהים יציבים, קינון בלתי מוגבל, תמיכה ב־Undo, וגרסאות.

```json
{
  "schema_version": 1,
  "app": {
    "timezone": "Asia/Jerusalem",
    "date_format": "DD/MM/YY",
    "rtl": true,
    "theme": "system"
  },
  "ui_state": {
    "project_order": ["proj_1", "proj_2"],
    "locked_projects": {
      "proj_1": { "locked_until_epoch_ms": 1769999999999 }
    },
    "undo": {
      "stack": [],
      "redo_stack": []
    }
  },
  "projects": [
    {
      "id": "proj_1",
      "title": "שם פרויקט",
      "short_description": "תיאור קצר",
      "detailed_description": "טקסט תיאור מפורט לפרויקט",
      "notebook": "טקסט חופשי - מחברת טיוטה",
      "tags": ["תגית1", "תגית2"],
      "color": "auto",
      "time_range": {
        "start_iso": "2025-12-01T00:00:00+02:00",
        "end_iso": "2026-01-15T00:00:00+02:00",
        "is_user_defined": true
      },
      "milestones": [
        {
          "id": "task_1",
          "title": "אבן דרך",
          "details": "תיאור מפורט למשימה",
          "status": {
            "type": "in_progress",
            "waiting_for": null
          },
          "priority": 2,
          "tags": ["תגיתA"],
          "color": "auto",
          "schedule": {
            "mode": "range",
            "start_iso": "2025-12-10T10:00:00+02:00",
            "end_iso": "2025-12-12T18:00:00+02:00"
          },
          "people": ["דני", "נועה"],
          "notes": "טקסט הערות חופשי",
          "subtasks": [
            {
              "id": "task_1_1",
              "title": "תת משימה",
              "details": "תיאור מפורט לתת משימה",
              "status": {
                "type": "waiting_for",
                "waiting_for": "דני"
              },
              "priority": 3,
              "tags": [],
              "color": "auto",
              "schedule": {
                "mode": "point",
                "point_iso": "2025-12-11T12:30:00+02:00"
              },
              "people": ["דני"],
              "notes": "",
              "subtasks": []
            }
          ]
        }
      ]
    }
  ],
  "backups": [
    {
      "id": "bkp_20251227_120000",
      "created_at_iso": "2025-12-27T12:00:00+02:00",
      "reason": "manual_save",
      "file_path": "backups/tasks_20251227_120000.json"
    }
  ]
}
```

### הערות סכימה (יישומיות)

* `schedule.mode`:

  * `range` כולל start/end
  * `point` כולל point_iso בלבד (משימה ללא טווח)
* `status.type`:

  * `not_started` | `in_progress` | `stuck` | `done` | `waiting_for`
  * אם `waiting_for` אז `waiting_for` מחויב להיות שם
* `color: "auto"` מאפשר ל־UI לבחור צבע מובחן אוטומטית לחפיפות; אפשר גם לאפשר hex בהמשך
* `ui_state` נשמר גם הוא ב־JSON כדי לשחזר סדר פרויקטים ונעילות (אבל אתה ביקשת שנעילה לא תשרוד סגירת דפדפן; לכן בפועל אפשר לשמור את זה רק ב־LocalStorage, או לשמור ב־JSON אבל להתעלם בטעינה. מומלץ: LocalStorage.)

---

# רשימת API Endpoints (FastAPI)

בסגנון REST, ללא auth, JSON בלבד, “האחרון מנצח”.

## מערכת וקובץ

* `GET /api/health`

  * בדיקת זמינות
* `GET /api/state`

  * מחזיר את כל ה־JSON (כולל projects)
* `POST /api/state/save`

  * שמירה גלובלית (יוצר גם backup)
  * body: כל ה־state
  * response: `{ saved_at, backup_id }`
* `GET /api/state/backups`

  * רשימת גיבויים
* `POST /api/state/backups/{backup_id}/restore`

  * שחזור מגיבוי (האחרון מנצח)

## פרויקטים

* `POST /api/projects`

  * יצירת פרויקט חדש
* `GET /api/projects`

  * רשימת פרויקטים (לפי `project_order`)
* `GET /api/projects/{project_id}`

  * פרויקט יחיד
* `PATCH /api/projects/{project_id}`

  * עדכון שדות (שם, תיאור, טווח, תגיות, צבע…)
* `DELETE /api/projects/{project_id}`

  * מחיקה

## סדר פרויקטים

* `PATCH /api/ui/project-order`

  * עדכון סדר ידני
  * body: `{ project_order: [...] }`

## משימות (Milestones) בתוך פרויקט

* `POST /api/projects/{project_id}/tasks`

  * יצירת משימה
* `PATCH /api/projects/{project_id}/tasks/{task_id}`

  * עדכון משימה
* `DELETE /api/projects/{project_id}/tasks/{task_id}`

  * מחיקה

## תתי־משימות (רק אותו מודל “Task” בקינון)

* `POST /api/projects/{project_id}/tasks/{task_id}/subtasks`
* `PATCH /api/projects/{project_id}/tasks/{task_id}/subtasks/{subtask_id}`
* `DELETE /api/projects/{project_id}/tasks/{task_id}/subtasks/{subtask_id}`

> בפועל, בגלל קינון בלתי מוגבל, מומלץ endpoint כללי שמקבל “נתיב”:

* `PATCH /api/projects/{project_id}/task-node`

  * body: `{ path: ["task_1","task_1_1","task_1_1_3"], patch: {...} }`
* `POST /api/projects/{project_id}/task-node`

  * body: `{ parent_path: ["task_1","task_1_1"], node: {...} }`
* `DELETE /api/projects/{project_id}/task-node`

  * body: `{ path: [...] }`

## פעולות ציר זמן (Drag/Resize/Snap)

(אפשר לממש כ־PATCH רגיל למשימה, אבל נוח להפריד)

* `POST /api/projects/{project_id}/tasks/{task_id}/schedule`

  * body:

    * להזזה: `{ action:"move", delta_ms: ... }`
    * לשינוי משך: `{ action:"resize", start_iso?, end_iso? }`
    * לעריכה ידנית: `{ action:"set", mode:"range|point", ... }`

## טיוטה ותיאורים

* `PATCH /api/projects/{project_id}/notebook`

  * body: `{ notebook: "..." }`
* `PATCH /api/projects/{project_id}/description`

  * body: `{ detailed_description: "..." }`
* `PATCH /api/projects/{project_id}/tasks/{task_id}/details`

  * body: `{ details: "..." }`

---

# כללי UI שחשוב להגדיר ליישום

* RTL אמיתי (כולל ציר זמן מימין לשמאל, עבר מימין)
* במובייל:

  * נגיעה קצרה = hover
  * גרירה לסדר פרויקטים עם “handle” ברור כדי לא להתנגש בגלילה
* Undo/Redo:

  * נשמר בצד לקוח עד שמירה גלובלית
  * שמירה גלובלית מאפסת/מסדרת את היסטוריית הפעולות לפי החלטה (מומלץ לשמור Undo רק בזיכרון לקוח)

---
